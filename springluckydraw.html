<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜¥æ—¥ç¾è‚Œç¶»æ”¾å¤§æŠ½ç - NeoDerm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --neo-rose: #ff4d6d;
            --neo-rose-dark: #c9184a;
            --neo-sky: #0ea5e9;
            --neo-sky-dark: #0369a1;
            --gold: #fbbf24;
            --glass-white: rgba(255, 255, 255, 0.92);
        }

        body {
            font-family: 'Poppins', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #fff1f2 100%);
            color: #1e293b;
            min-height: 100vh;
            margin: 0; padding: 0; overflow-x: hidden;
        }

        /* æ«»èŠ±èƒŒæ™¯ */
        #sakura-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; }
        .petal { position: absolute; background: linear-gradient(135deg, #ffdbed 0%, #ffb7d5 100%); border-radius: 150% 0 150% 50%; opacity: 0.5; animation: fall linear infinite; }
        @keyframes fall { 0% { transform: translate(0, -20px) rotate(0deg) scale(1); } 100% { transform: translate(100px, 110vh) rotate(720deg) scale(0.6); } }

        .banner-container {
            width: 100%;
            background: #fff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            display: flex;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        .banner-img {
            width: 100%;
            max-width: 1000px;
            height: auto;
            display: block;
            object-fit: contain;
        }

        .prize-float-badge {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(3, 105, 161, 0.9);
            backdrop-filter: blur(8px);
            padding: 8px 24px;
            border-radius: 40px;
            border: 2px solid rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            z-index: 20;
            box-shadow: 0 10px 25px rgba(3, 105, 161, 0.3);
        }

        .glass-card {
            background: var(--glass-white);
            backdrop-filter: blur(20px);
            border: 1px solid white;
            border-radius: 28px;
            box-shadow: 0 15px 45px rgba(0, 0, 0, 0.05);
            position: relative;
            z-index: 10;
        }

        .neo-gradient-text {
            background: linear-gradient(135deg, #0369a1 0%, #c9184a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
        }

        .pool-tab { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0.65; cursor: pointer; }
        .pool-tab.active { opacity: 1; transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); border: 2px solid white; }

        .gacha-container { position: relative; width: 260px; height: 360px; margin: 0 auto; }
        .gacha-glass {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 240px; height: 240px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9) 0%, rgba(186, 230, 253, 0.4) 100%);
            border: 6px solid #fff; border-radius: 50%; overflow: hidden;
            box-shadow: inset 0 10px 30px rgba(255,255,255,1), 0 15px 30px rgba(0,0,0,0.05);
            z-index: 5;
        }
        .gacha-base {
            position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 200px; height: 140px; background: linear-gradient(135deg, #0ea5e9 0%, #0369a1 100%);
            border-radius: 20px 20px 40px 40px; z-index: 4; border: 3px solid #fff;
        }
        .gacha-knob { width: 50px; height: 50px; background: #fbbf24; border-radius: 50%; border: 3px solid #fff; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; }
        .shaking { animation: shake 0.1s infinite; }
        @keyframes shake { 0%, 100% { transform: translate(-50%, 0); } 25% { transform: translate(-51%, 1px); } 75% { transform: translate(-49%, -1px); } }

        .btn-main {
            background: linear-gradient(135deg, #0369a1 0%, #0ea5e9 100%);
            color: white; padding: 16px 48px; border-radius: 100px; font-weight: 800;
            transition: 0.3s; box-shadow: 0 10px 25px rgba(14, 165, 233, 0.3);
        }
        .btn-main:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; }

        .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 100px; font-size: 10px; font-weight: 900; letter-spacing: 0.5px; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .st-online { background: #dcfce7; color: #15803d; }
        .st-online .status-dot { background: #22c55e; }
        .st-loading { background: #fef9c3; color: #a16207; }
        .st-loading .status-dot { background: #eab308; animation: pulse 1s infinite; }
        .st-offline { background: #fee2e2; color: #ef4444; }
        .st-offline .status-dot { background: #ef4444; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        .hidden-step { display: none; }
    </style>
</head>
<body class="antialiased">
    <div id="sakura-container"></div>

    <div class="banner-container">
        <div class="prize-float-badge">
            <span class="text-xl">ğŸ’</span>
            <div class="text-xs font-bold leading-tight">Ultherapy ç™‚ç¨‹ <span class="text-amber-400">$32,888</span></div>
        </div>
        <img src="https://image2url.com/r2/default/images/1772197034322-b5062db0-1c7c-4337-a113-a1e0f9b526ff.jpeg" class="banner-img" alt="NeoDerm Spring">
    </div>

    <div class="max-w-4xl mx-auto px-4 py-8 relative z-10">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl neo-gradient-text mb-4">æ˜¥æ—¥ç¾è‚Œç¶»æ”¾å¤§æŠ½ç</h1>
            <p class="text-sky-800 font-bold bg-white/60 inline-block px-4 py-1 rounded-full text-xs">å³æ—¥è‡³ 2026å¹´3æœˆ31æ—¥</p>
        </header>

        <div id="step-eligibility" class="glass-card p-6 md:p-10 mb-8">
            <div class="text-center mb-8">
                <h2 class="text-lg font-black text-slate-800 uppercase tracking-wide">è«‹é¸æ“‡æ¶ˆè²»å½©æ± </h2>
                <p class="text-slate-400 text-[10px]">é…é¡è³‡æ–™æ­£åœ¨å¾æ‚¨çš„ Google è©¦ç®—è¡¨è¼‰å…¥</p>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                <button onclick="selectPool('gold')" id="tab-gold" class="pool-tab tab-gold p-6 rounded-3xl bg-amber-50 border border-amber-100 flex flex-col items-center gap-2">
                    <span class="text-2xl">âœ¨</span>
                    <span class="font-black text-sm text-amber-800">æ˜¥æ—¥é‡‘æ± </span>
                    <span class="text-[9px] font-bold py-1 px-3 bg-white/60 rounded-full">>= $50,000</span>
                </button>
                <button onclick="selectPool('silver')" id="tab-silver" class="pool-tab tab-silver p-6 rounded-3xl bg-slate-50 border border-slate-100 flex flex-col items-center gap-2">
                    <span class="text-2xl">ğŸ¥ˆ</span>
                    <span class="font-black text-sm text-slate-800">æ˜¥æ—¥éŠ€æ± </span>
                    <span class="text-[9px] font-bold py-1 px-3 bg-white/60 rounded-full">$30K - $49K</span>
                </button>
                <button onclick="selectPool('bronze')" id="tab-bronze" class="pool-tab tab-bronze p-6 rounded-3xl bg-orange-50 border border-orange-100 flex flex-col items-center gap-2">
                    <span class="text-2xl">ğŸ¥‰</span>
                    <span class="font-black text-sm text-orange-800">æ˜¥æ—¥éŠ…æ± </span>
                    <span class="text-[9px] font-bold py-1 px-3 bg-white/60 rounded-full">$15K - $29K</span>
                </button>
            </div>

            <div class="flex justify-center mb-10">
                <button onclick="selectPool('birthday')" id="tab-birthday" class="pool-tab tab-birthday w-full max-w-md p-6 rounded-3xl bg-pink-50 border border-pink-100 flex items-center justify-center gap-4">
                    <span class="text-3xl">ğŸ‚</span>
                    <div class="text-left">
                        <span class="font-black text-sm block text-pink-800">ç”Ÿæ—¥å½©æ±  ç‰¹åˆ¥çå‹µ</span>
                        <span class="text-[9px] font-bold opacity-70 uppercase tracking-widest text-pink-600">2 / 3 / 4 æœˆç”Ÿæ—¥å°ˆäº«</span>
                    </div>
                </button>
            </div>

            <div id="loading-box" class="bg-white/40 border border-white p-6 rounded-2xl mb-8 text-center min-h-[100px] flex flex-col items-center justify-center transition-all">
                <p id="pool-desc" class="text-slate-600 text-xs font-medium italic mb-3">é€£ç·šé›²ç«¯è³‡æ–™åº«ä¸­...</p>
                <div id="conn-badge" class="status-badge st-loading">
                    <div class="status-dot"></div>
                    <span id="conn-text">Connecting...</span>
                </div>
            </div>

            <button id="entry-btn" onclick="confirmEntry()" disabled class="w-full btn-main uppercase tracking-widest">è«‹ç­‰å¾…é€£ç·šå®Œæˆ</button>
            
            <button onclick="toggleDashboard()" class="w-full mt-10 text-slate-400 text-[10px] font-bold tracking-widest hover:text-sky-500 uppercase">
                ğŸ“Š ç®¡ç†å“¡é…é¡è¨ºæ–·
            </button>
            
            <div id="dashboard" class="hidden mt-6 bg-slate-800 rounded-2xl p-6 shadow-2xl">
                <div id="dash-auth">
                    <div class="flex gap-2 max-w-xs mx-auto">
                        <input type="password" id="dash-pass" placeholder="ç®¡ç†å¯†ç¢¼" class="flex-1 px-4 py-2 rounded-xl text-sm border-none outline-none bg-slate-700 text-white">
                        <button onclick="unlockDash()" class="bg-sky-500 text-white px-5 py-2 rounded-xl text-xs font-bold">è§£é–</button>
                    </div>
                </div>
                <div id="dash-data" class="hidden text-white">
                    <div class="flex justify-between items-center mb-4 border-b border-slate-700 pb-2">
                        <span class="text-[10px] font-bold text-sky-400">SHEET LIVE INVENTORY</span>
                        <button onclick="fetchData()" class="text-[9px] bg-slate-700 px-2 py-1 rounded">æ›´æ–°è³‡æ–™åº«</button>
                    </div>
                    <div id="quota-list" class="space-y-4 max-h-60 overflow-y-auto"></div>
                </div>
            </div>
        </div>

        <div id="step-draw" class="hidden-step text-center py-10">
            <div class="flex justify-between items-center mb-10">
                <button onclick="location.reload()" class="text-[10px] font-bold text-slate-400 px-4 py-2 bg-white/50 rounded-xl">â¬… è¿”å›é‡é¸</button>
                <div id="pool-name-badge" class="px-5 py-1.5 rounded-full bg-sky-600 text-white text-[10px] font-black uppercase">çµ„åˆ¥</div>
            </div>
            <div class="gacha-container mb-12" id="gacha-box">
                <div class="gacha-glass"><div id="balls-wrap" class="relative w-full h-full"></div></div>
                <div class="gacha-base"><div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"><div class="gacha-knob" onclick="startDraw()">ğŸ’®</div></div></div>
            </div>
            <button id="draw-btn" onclick="startDraw()" class="btn-main animate-bounce">é»æ“Šè½‰å‹•æŠ½ç</button>
        </div>

        <div id="res-modal" class="fixed inset-0 bg-slate-900/90 backdrop-blur-xl flex items-center justify-center p-6 z-50 hidden">
            <div class="glass-card p-8 max-w-md w-full text-center">
                <div class="text-5xl mb-6">ğŸŒ¸</div>
                <p class="text-xs text-sky-600 font-bold uppercase mb-2">ä¸­çé€šçŸ¥</p>
                <p class="text-2xl font-black text-slate-800 mb-8" id="win-text">çå“</p>
                <div class="space-y-4 mb-8">
                    <div class="grid grid-cols-2 gap-3">
                        <input type="text" id="in-mmc" oninput="validateForm()" placeholder="MMC ç·¨è™Ÿ" class="px-4 py-3 rounded-xl text-sm border border-slate-200 outline-none w-full">
                        <input type="text" id="in-inv" oninput="validateForm()" placeholder="Inv No." class="px-4 py-3 rounded-xl text-sm border border-slate-200 outline-none w-full">
                    </div>
                    <select id="in-cse" onchange="validateForm()" class="w-full px-4 py-3 rounded-xl text-sm border border-slate-200 outline-none">
                        <option value="">è² è²¬åŒäº‹ (CSE)...</option>
                        <option value="miko.ngan">miko.ngan</option><option value="karykwong">karykwong</option><option value="angel.leungsl">angel.leungsl</option><option value="Helen.hui">Helen.hui</option><option value="sammi.ng">sammi.ng</option><option value="rania.lam">rania.lam</option><option value="winslee.hui">winslee.hui</option><option value="angela.chanhs">angela.chanhs</option><option value="aislin.hui">aislin.hui</option><option value="niki.ng">niki.ng</option><option value="yannux.man">yannux.man</option><option value="crystal.chanhy">crystal.chanhy</option><option value="rebecca.lam">rebecca.lam</option><option value="zoe.sohy">zoe.sohy</option><option value="joanne.chancy">joanne.chancy</option><option value="karena.leung.wt">karena.leung.wt</option><option value="miko.chen">miko.chen</option><option value="abbie.wong.kn">abbie.wong.kn</option><option value="michelle.choi">michelle.choi</option><option value="miki.wong">miki.wong</option><option value="Chrissie.wong">Chrissie.wong</option><option value="fanky.lam">fanky.lam</option><option value="milky.chong">milky.chong</option><option value="winnie.mowy">winnie.mowy</option><option value="ebbie.tam">ebbie.tam</option><option value="sharon.chu">sharon.chu</option><option value="wing.Chau">wing.Chau</option><option value="Angela.ChanHY">Angela.ChanHY</option><option value="Daisy.Wong">Daisy.Wong</option><option value="yandy.lee">yandy.lee</option>
                    </select>
                </div>
                <div id="sub-msg" class="text-xs mb-4 hidden font-bold text-emerald-600"></div>
                <button id="sub-btn" onclick="submitResult()" disabled class="w-full btn-main py-4 rounded-2xl opacity-50">ç¢ºèªå­˜æª”ä¸¦æ‰£é™¤é…é¡</button>
            </div>
        </div>
    </div>

    <script type="module">
        const scriptURL = "https://script.google.com/macros/s/AKfycbzk4csonS3ILtM8Kye2HaJF2JhKTRCRoLNFHJssHy3fnNgzVwRoheEcKvm6K_6eI9AT/exec";
        
        let sheetData = []; 
        let selectedKey = 'silver';
        let currentPoolPrizes = [];
        let winPrizeName = "";
        let isSpinning = false;

        const poolMeta = {
            gold: { name: "æ˜¥æ—¥é‡‘æ±  (Premium)", desc: "æ¶ˆè²»é‡‘é¡é” $50,000 æˆ–ä»¥ä¸Šã€‚" },
            silver: { name: "æ˜¥æ—¥éŠ€æ±  (Elite)", desc: "æ¶ˆè²»é‡‘é¡ä»‹ä¹ $30,000 è‡³ $49,999ã€‚" },
            bronze: { name: "æ˜¥æ—¥éŠ…æ±  (Standard)", desc: "æ¶ˆè²»é‡‘é¡ä»‹ä¹ $15,000 è‡³ $29,999ã€‚" },
            birthday: { name: "ç”Ÿæ—¥å½©æ±  (Special)", desc: "é©ç”¨æ–¼ 2ã€3ã€4 æœˆä»½ç”Ÿæ—¥ä¹‹å®¢æˆ¶ã€‚" }
        };

        window.fetchData = async () => {
            const badge = document.getElementById('conn-badge');
            const text = document.getElementById('conn-text');
            const entryBtn = document.getElementById('entry-btn');

            badge.className = "status-badge st-loading";
            text.innerText = "Syncing with Sheet...";

            try {
                // ä½¿ç”¨å¿«å–æ¸…é™¤åƒæ•¸
                const response = await fetch(`${scriptURL}?v=${Date.now()}`);
                if (!response.ok) throw new Error("Connection Error");
                
                sheetData = await response.json();
                
                if (sheetData.error) throw new Error(sheetData.error);

                badge.className = "status-badge st-online";
                text.innerText = "Online (Sheet Connected)";
                entryBtn.disabled = false;
                entryBtn.innerText = "é€²å…¥æŠ½ç";
                
                renderDashboard();
                updateDesc();
            } catch (err) {
                console.error("Fetch Error:", err);
                badge.className = "status-badge st-offline";
                text.innerText = "é€£ç·šå¤±æ•— (Failed to fetch)";
                entryBtn.innerText = "ç„¡æ³•è¼‰å…¥é…é¡è³‡æ–™";
            }
        };

        window.selectPool = (key) => {
            selectedKey = key;
            document.querySelectorAll('.pool-tab').forEach(b => b.classList.remove('active'));
            document.getElementById(`tab-${key}`).classList.add('active');
            updateDesc();
        };

        function updateDesc() {
            const el = document.getElementById('pool-desc');
            if (sheetData.length === 0) return;
            el.innerText = poolMeta[selectedKey].desc;
        }

        window.toggleDashboard = () => document.getElementById('dashboard').classList.toggle('hidden');
        window.unlockDash = () => {
            if (document.getElementById('dash-pass').value === "SoloTiff2004") {
                document.getElementById('dash-auth').classList.add('hidden');
                document.getElementById('dash-data').classList.remove('hidden');
            }
        };

        function renderDashboard() {
            let html = "";
            ['gold', 'silver', 'bronze', 'birthday'].forEach(k => {
                const items = sheetData.filter(d => d.pool === k);
                html += `<div class="mb-4"><p class="text-[9px] text-sky-400 font-bold mb-1">${poolMeta[k].name}</p>`;
                html += `<table class="w-full text-[9px] border-collapse">`;
                items.forEach(i => {
                    html += `<tr class="border-b border-slate-700">
                        <td class="py-1">${i.name}</td>
                        <td class="text-right ${i.remaining <= 0 ? 'text-rose-500 font-bold' : 'text-slate-400'}">${i.remaining} / ${i.total}</td>
                    </tr>`;
                });
                html += `</table></div>`;
            });
            document.getElementById('quota-list').innerHTML = html;
        }

        window.confirmEntry = () => {
            currentPoolPrizes = sheetData.filter(d => d.pool === selectedKey);
            document.getElementById('step-eligibility').classList.add('hidden-step');
            document.getElementById('step-draw').classList.remove('hidden-step');
            document.getElementById('pool-name-badge').innerText = poolMeta[selectedKey].name;
            setupGacha();
        };

        function setupGacha() {
            const wrap = document.getElementById('balls-wrap'); wrap.innerHTML = "";
            for(let i=0; i<12; i++) {
                const b = document.createElement('div');
                b.className = "absolute w-8 h-8 rounded-full border border-white/20";
                b.style.left = Math.random()*80 + "%"; b.style.top = Math.random()*70 + "%";
                b.style.background = `radial-gradient(circle at 30% 30%, #fb7185, #0003)`;
                wrap.appendChild(b);
            }
        }

        window.startDraw = () => {
            if (isSpinning) return;
            const available = currentPoolPrizes.filter(p => p.remaining > 0);
            if (available.length === 0) { alert("æ­¤å½©æ± çå“å·²å…¨æ•¸æŠ½å®Œï¼"); return; }

            isSpinning = true;
            document.getElementById('gacha-box').classList.add('shaking');
            document.getElementById('draw-btn').disabled = true;

            const totalRem = available.reduce((s, p) => s + p.remaining, 0);
            let rnd = Math.random() * totalRem, cur = 0;
            for (let i = 0; i < available.length; i++) {
                cur += available[i].remaining;
                if (rnd <= cur) { winPrizeName = available[i].name; break; }
            }

            setTimeout(() => {
                document.getElementById('gacha-box').classList.remove('shaking');
                document.getElementById('win-text').innerText = winPrizeName;
                document.getElementById('res-modal').classList.remove('hidden');
                isSpinning = false;
            }, 2000);
        };

        window.validateForm = () => {
            const valid = document.getElementById('in-mmc').value.trim() && document.getElementById('in-inv').value.trim() && document.getElementById('in-cse').value;
            const btn = document.getElementById('sub-btn');
            btn.disabled = !valid; btn.style.opacity = valid ? "1" : "0.5";
        };

        window.submitResult = async () => {
            const btn = document.getElementById('sub-btn');
            btn.disabled = true; btn.innerText = "Saving to Google Sheet...";
            const payload = {
                mmc: document.getElementById('in-mmc').value.trim(),
                invoice_no: document.getElementById('in-inv').value.trim(),
                cse: document.getElementById('in-cse').value,
                pool: poolMeta[selectedKey].name,
                pool_id: selectedKey,
                prize: winPrizeName
            };
            try {
                await fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
                document.getElementById('sub-msg').innerText = "âœ… å·²æˆåŠŸæ›´æ–°è©¦ç®—è¡¨ï¼é é¢å³å°‡è·³è½‰...";
                document.getElementById('sub-msg').classList.remove('hidden');
                setTimeout(() => location.reload(), 2000);
            } catch (e) {
                alert("å­˜æª”å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²è·¯é€£ç·šã€‚");
                btn.disabled = false;
            }
        };

        window.onload = fetchData;

        const sc = document.getElementById('sakura-container');
        for (let i = 0; i < 20; i++) {
            const p = document.createElement('div'); p.className = 'petal w-2 h-2';
            p.style.left = Math.random() * 100 + 'vw'; p.style.animationDuration = Math.random() * 4 + 4 + 's';
            p.style.animationDelay = Math.random() * 5 + 's'; sc.appendChild(p);
        }
    </script>
</body>
</html>
